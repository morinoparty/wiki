<template>
  <aside class="side">
    <div class="top">
      <nuxt-link to="/">
        <section id="logo">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 90.68">
            <path
              class="cls-1"
              d="M0,24.74l6.53-10.3a14.43,14.43,0,0,1,3.27-.25c7.91,0,14.19,5.4,14.19,12.06a13,13,0,0,1-4,9ZM42.07,54.89c0,.62-.12,1.13-.12,1.75C42,68.2,51.12,74.1,59.41,74.1a13.66,13.66,0,0,0,10.3-4.27,16.56,16.56,0,0,1,.37,3.39c0,7-6.53,12.69-19.47,12.69-17.08,0-28.13-10.55-29.26-29.64L3.26,57.4,4.77,45.47H23.61c.5-12.44,5.28-28.39,8.17-38.18l20.47,4.27c-4,13.18-7.54,21.6-8.67,34.16,7.41.25,14.32.37,19.47.63l.63,7.15Z"
            />
            <path
              class="cls-1"
              d="M112.17,50.49a13.18,13.18,0,0,1-11.81,7A10.78,10.78,0,0,1,89.44,49a76.55,76.55,0,0,1-1-14.32c0-6.9.38-13.81.75-17.08l17.71.76c-.12,2.76-.12,5.9-.12,9.42,0,6.15.12,13.43.63,21.35Zm34-38.31A245.43,245.43,0,0,1,150.35,53q0,4.71-.38,8.67c-1.38,14.69-13.56,22.1-23,23.48.5-7,.63-14.19.63-21.47,0-18.72-1.26-37-2.39-50.24Z"
            />
            <path
              class="cls-1"
              d="M204.37,71.21a12.1,12.1,0,0,1-11.18,8.17c-5.15,0-10.17-3.52-11.93-11.81-3-15.32-4.14-38.43-4.14-53.25V12.06l22.35-1.26c.76,18.21,1,39.44,1.64,58Zm51.87-4a23.27,23.27,0,0,0-5.9-5.65c0,13.69-8.67,21.73-22.36,21.73-12.93,0-19.72-8-19.72-16.33,0-9.29,7.67-17.58,21.1-18.46-.12-3.89-.25-8.16-.5-12.31l-11.05-.5,1.38-7.29,8-.25c-.25-11-.5-20.22-.5-20.22l19.59-.37c.5,4.89,1.26,12.05,1.76,19.84,4.64.13,9.29.25,13.56.5l.5,10.05-11.93-.63c.25,5.4.38,10.68.38,15.32,4.9,2.39,8.92,5.41,11.55,9.05Zm-35.67-4c0,2.89,1.63,5.66,4.65,5.66,4.27,0,4.27-4.15,4.27-13.19C223.59,56.14,220.57,59.28,220.57,63.17Zm43-37.8c-7.79,0-13.19-4.39-13.19-11.55C250.34,5.65,257.5,0,263.65,0c8.92,0,13.69,6.78,13.69,11.93C277.34,15.45,275.46,25.37,263.53,25.37Zm5.9-13.31c0-5.65-6-5.78-6.78-5.78-3.39,0-6.41,3.14-6.41,7s3.27,5.78,6.78,5.78S269.43,16.33,269.43,12.06Z"
            />
            <path
              class="cls-1"
              d="M285.64,45.21l1.26-16.57c2-.13,3.89-.13,5.78-.13,26.88,0,37.3,12.81,37.3,26.88,0,17.08-15.32,35.29-33.16,35.29-3.89,0-7.91-1.13-9.79-4.65,14.56-4.77,24.11-16.32,24.11-25.87,0-8.16-7-14.95-23.74-14.95Zm8-27.63L297.32,2a28.85,28.85,0,0,1,7.29-.88c8.92,0,16.83,4.14,16.83,13.06a21.47,21.47,0,0,1-1.51,7.29Z"
            />
            <path
              class="cls-1"
              d="M373.82,75.86c-1,6.41-5.53,9.54-10.3,9.54a12.42,12.42,0,0,1-10.8-7c-3.89-7.28-7.16-22.86-8-29l17.08-3.89c1.76,7.66,4.78,18.58,8.54,30Zm10.8-18.46,6.66-10.55c8.92.5,13.56,5.77,13.56,11.3a11.22,11.22,0,0,1-5.27,9.3Z"
            />
            <path
              class="cls-1"
              d="M415.65,22.61l4.15-11.93a13.19,13.19,0,0,1,2.26-.13c7.54,0,13.06,4.4,13.06,10.93a14.18,14.18,0,0,1-1.76,6.65Zm47.48,18.21c2.64,8,6,15.32,10.3,20.47-8.17,1.26-17.46,3.27-21.86,5.15C443,70.33,439.39,73.6,439.39,76s4.15,4.15,10.93,4.4a11.34,11.34,0,0,1,.38,2.76c0,3.27-2,5.53-5.78,5.53-9.3,0-24.12-7.16-24.12-17.08,0-6.53,6.66-13.56,24-18.59a43.87,43.87,0,0,1-2.89-8.92L416.41,48l-.13-11.68c5.15-.51,14.82-1.38,25.37-2.14a189.15,189.15,0,0,1-1.38-21.35,58.31,58.31,0,0,1,.5-9.17L457.1,2.39a160.33,160.33,0,0,0,4.52,30.27c5.53-.38,10.55-.76,14.45-.88l1.63,6.78Z"
            />
            <path
              class="cls-1"
              d="M493.54,57.4c-5-18.84-6.78-38.69-7-53.26L512,3.52l-7.66,53.25Zm6,31.14c-6.79,0-11.68-3.76-11.68-10.17,0-6.78,5.65-12.43,11.93-12.43,4.27,0,12.06,3.14,12.06,10.67C511.88,81.39,509.24,88.54,499.57,88.54Z"
            />
          </svg>
        </section>
      </nuxt-link>

      <button class="open" v-on:click="toggle_class()" v-bind:class="{ 'view' : isOpen }">
        <svg
          fill="#ffffff"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          width="24px"
          height="24px"
        >
          <path
            d="M12,14.071L8.179,10.25c-0.414-0.414-1.086-0.414-1.5,0l0,0c-0.414,0.414-0.414,1.086,0,1.5l4.614,4.614 c0.391,0.391,1.024,0.391,1.414,0l4.614-4.614c0.414-0.414,0.414-1.086,0-1.5v0c-0.414-0.414-1.086-0.414-1.5,0L12,14.071z"
          />
        </svg>
      </button>
    </div>

    <a
      :href="'/admin/#/collections/wiki/entries/'+this.$nuxt.$route.params.page"
      style="text-decoration:none;"
      v-if="this.$nuxt.$route.params.page"
    >
      <section id="login" class="d-flex justify-content-center">
        <div class="link d-flex align-items-center">
          <div class="icon">
            <i class="fas fa-edit"></i>
          </div>
          <div class="text text-center">このページを編集する</div>
        </div>
      </section>
    </a>
    <a :href="'/admin/'" style="text-decoration:none;" v-if="!this.$nuxt.$route.params.page">
      <section id="login" class="d-flex justify-content-center">
        <div class="link d-flex align-items-center">
          <div class="icon">
            <i class="fas fa-edit"></i>
          </div>
          <div class="text text-center">投稿画面にアクセス</div>
        </div>
      </section>
    </a>

    <nav id="side" v-bind:class="{ 'view' : isOpen }">
      <div v-for="nav in nav" :key="nav.id">
        <nuxt-link :to="'/'+nav.slug" v-if="nav.label">
          <div class="link d-flex align-items-center label">
            <div class="icon">
              <i :class="'fas fa-'+nav.icon"></i>
            </div>
            <div class="text" style="font-weight:bold">{{nav.title}}</div>
          </div>
        </nuxt-link>
        <nuxt-link :to="'/'+nav.slug" v-if="!nav.label">
          <div class="child">
            <div class="link d-flex align-items-center">
              <div class="text">{{nav.title}}</div>
            </div>
          </div>
        </nuxt-link>
      </div>
    </nav>
  </aside>
</template>
<script>
import axios from "axios";
export default {
  data() {
    return {
      nav: null,
      isOpen: false
    };
  },
  head() {
    return {
      script: [
        { src: "https://identity.netlify.com/v1/netlify-identity-widget.js" }
      ]
    };
  },
  methods: {
    fetchNav() {
      axios
        .get(
          "https://moripawiki.microcms.io/api/v1/category_tutorial?fields=title,slug,label,icon&limit=1000",
          {
            headers: { "X-API-KEY": "0dd1daaa-f36e-4e25-b552-1f93057baf39" }
          }
        )
        .then(res => {
          console.log(res.data);
          this.nav = res.data.contents;
        })
        .catch(err => {
          console.log(err);
        });
    },
    modifyDatetime(date) {
      const Ymd = date.split("T")[0];
      const His = date.split("T")[1].split(".")[0];

      return Ymd + " " + His;
    },
    toggle_class() {
      this.isOpen = !this.isOpen;
    }
  },
  mounted() {
    this.fetchNav();
  }
};
</script>